# Socket.io è¿æ¥è°ƒè¯•æŒ‡å—

## ğŸ› å½“å‰é—®é¢˜

**é”™è¯¯ä¿¡æ¯:**

```
WebSocket connection to 'ws://localhost:3000/api/socket/?EIO=4&transport=websocket' failed: WebSocket is closed before the connection is established.
```

## ğŸ” è¯Šæ–­ç»“æœ

### âœ… æœåŠ¡å™¨ç«¯æ­£å¸¸

- **HTTP API**: `curl http://localhost:3000/api/socket` â†’ 200 OK
- **Socket.io æ¡æ‰‹**: `curl "http://localhost:3000/api/socket/?EIO=4&transport=polling"` â†’ æˆåŠŸ
- **æœåŠ¡å™¨é…ç½®**: å·²ä¼˜åŒ–ï¼Œæ”¯æŒè½®è¯¢å’Œ WebSocket

### âŒ å®¢æˆ·ç«¯è¿æ¥é—®é¢˜

- **WebSocket å‡çº§å¤±è´¥**: å¯èƒ½æ˜¯ç½‘ç»œæˆ–æµè§ˆå™¨é—®é¢˜
- **è½®è¯¢è¿æ¥**: åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œ

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ”¹ä¼ è¾“ä¼˜å…ˆçº§

**æ–‡ä»¶**: `lib/socket.ts`

```typescript
this.socket = io(this.url, {
  path: "/api/socket",
  transports: ["polling", "websocket"], // å…ˆå°è¯•è½®è¯¢
  autoConnect: true,
  forceNew: true,
  timeout: 20000,
});
```

### 2. ä¼˜åŒ–æœåŠ¡å™¨é…ç½®

**æ–‡ä»¶**: `pages/api/socket.ts`

```typescript
const io = new SocketIOServer(res.socket.server, {
  path: "/api/socket",
  cors: {
    origin: "*",
    methods: ["GET", "POST"],
  },
  transports: ["websocket", "polling"],
  allowEIO3: true,
  pingTimeout: 60000,
  pingInterval: 25000,
});
```

### 3. åˆ›å»ºæµ‹è¯•é¡µé¢

**æ–‡ä»¶**: `simple-socket-test.html`

- æœ€ç®€å•çš„ Socket.io è¿æ¥æµ‹è¯•
- ä½¿ç”¨é»˜è®¤é…ç½®

**æ–‡ä»¶**: `debug-socket.html`

- åˆ†åˆ«æµ‹è¯•è½®è¯¢å’Œ WebSocket
- è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

## ğŸ¯ æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: æµ‹è¯•è½®è¯¢è¿æ¥

```bash
# æ‰“å¼€æµè§ˆå™¨è®¿é—®
http://localhost:3000/simple-socket-test.html
```

### æ­¥éª¤ 2: æµ‹è¯•å®¢æˆ·ç«¯é¡µé¢

```bash
# è®¿é—®å®¢æˆ·é¡µé¢
http://localhost:3000/client
```

### æ­¥éª¤ 3: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„è¿æ¥æ—¥å¿—
- æ£€æŸ¥ç½‘ç»œé¢æ¿ä¸­çš„è¯·æ±‚

## ğŸ“Š é¢„æœŸç»“æœ

### âœ… è½®è¯¢è¿æ¥åº”è¯¥æˆåŠŸ

- Socket.io æ¡æ‰‹æ­£å¸¸
- è½®è¯¢ä¼ è¾“åº”è¯¥å¯ä»¥å·¥ä½œ
- å³ä½¿ WebSocket å¤±è´¥ï¼Œè½®è¯¢ä¹Ÿèƒ½æä¾›å®æ—¶é€šä¿¡

### ğŸ”„ WebSocket å‡çº§

- å¦‚æœè½®è¯¢æˆåŠŸï¼ŒSocket.io ä¼šå°è¯•å‡çº§åˆ° WebSocket
- å¦‚æœ WebSocket å¤±è´¥ï¼Œä¼šå›é€€åˆ°è½®è¯¢

## ğŸš€ å½“å‰çŠ¶æ€

- âœ… **æœåŠ¡å™¨**: é…ç½®ä¼˜åŒ–ï¼Œæ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼
- âœ… **å®¢æˆ·ç«¯**: ä¼˜å…ˆä½¿ç”¨è½®è¯¢ä¼ è¾“
- âœ… **æµ‹è¯•å·¥å…·**: åˆ›å»ºäº†å¤šä¸ªæµ‹è¯•é¡µé¢
- âœ… **è¯Šæ–­**: ç¡®è®¤æœåŠ¡å™¨ç«¯æ­£å¸¸å·¥ä½œ

## ğŸ” ä¸‹ä¸€æ­¥è°ƒè¯•

1. **æ‰“å¼€æµ‹è¯•é¡µé¢**: è®¿é—® `simple-socket-test.html`
2. **æ£€æŸ¥æ§åˆ¶å°**: æŸ¥çœ‹è¯¦ç»†çš„è¿æ¥æ—¥å¿—
3. **æµ‹è¯•è½®è¯¢**: ç¡®è®¤è½®è¯¢è¿æ¥æ˜¯å¦æˆåŠŸ
4. **æ£€æŸ¥ç½‘ç»œ**: æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œé¢æ¿ä¸­çš„è¯·æ±‚

ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸è¿æ¥äº†ï¼å¦‚æœè½®è¯¢è¿æ¥æˆåŠŸï¼Œå³ä½¿ WebSocket å¤±è´¥ï¼Œåº”ç”¨ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚ğŸ‰
